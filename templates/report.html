<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PlacementIQ &ndash; Your Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes dash { from { stroke-dashoffset: 283; } }
    .ring-anim { animation: dash 1s ease-out forwards; }
    @keyframes grow { from { width: 0; } }
    .bar-fill { animation: grow .8s ease-out forwards; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans antialiased">

  <!-- Navbar -->
  <nav class="bg-white border-b border-gray-100 shadow-sm sticky top-0 z-30">
    <div class="max-w-6xl mx-auto px-6 h-14 flex items-center justify-between">
      <a href="/home" class="flex items-center gap-2 font-semibold text-gray-900">
        <span class="w-7 h-7 bg-indigo-600 rounded-lg flex items-center justify-center text-white text-sm">P</span>
        PlacementIQ
      </a>
      <div class="flex items-center gap-5 text-sm">
        <a href="/jobs" class="text-gray-500 hover:text-indigo-600 transition-colors font-medium">Browse Jobs</a>
        <a href="/" class="text-gray-500 hover:text-indigo-600 transition-colors font-medium">Analysis</a>
        {% if session.user %}
        <span class="text-gray-400">{{ session.user }}</span>
        {% endif %}
        <a href="/logout" class="bg-gray-100 text-gray-700 px-3 py-1.5 rounded-lg hover:bg-gray-200">Logout</a>
      </div>
    </div>
  </nav>

  <main class="max-w-5xl mx-auto px-6 py-10 space-y-8">

    <!-- Header -->
    <div class="flex items-center justify-between flex-wrap gap-4">
      <div>
        <h1 class="text-2xl font-semibold text-gray-800">Placement Report</h1>
        <p class="text-gray-400 text-sm mt-0.5">AI analysis for <span class="text-gray-600 font-medium">{{ result.meta.resume_filename }}</span></p>
      </div>
      <a href="/" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg text-sm hover:bg-gray-200 transition-colors">New Analysis</a>
    </div>

    <!-- Input echo bar -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 px-6 py-4 flex flex-wrap gap-x-8 gap-y-2 text-sm">
      {% if result.meta.github_user %}
      <span><span class="text-gray-400">GitHub</span> <span class="font-medium text-gray-700">{{ result.meta.github_user }}</span></span>
      {% endif %}
      {% if result.meta.leetcode_user %}
      <span><span class="text-gray-400">LeetCode</span> <span class="font-medium text-gray-700">{{ result.meta.leetcode_user }}</span></span>
      {% endif %}
      {% if result.meta.cgpa %}
      <span><span class="text-gray-400">CGPA</span> <span class="font-medium text-gray-700">{{ result.meta.cgpa }}</span></span>
      {% endif %}
    </div>

    <!-- Warnings -->
    {% if result.warnings %}
    <div class="bg-amber-50 border border-amber-200 rounded-2xl px-6 py-4 space-y-1.5">
      <h3 class="text-sm font-semibold text-amber-700 flex items-center gap-2">&#9888; Flags</h3>
      {% for w in result.warnings %}
      <p class="text-amber-700 text-sm">&bull; {{ w }}</p>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Three score cards -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-5">
      {% set scores = [
        ('Readiness', result.readiness | round(1), '#6366f1'),
        ('Role Match', (result.match * 100) | round(1), '#10b981'),
        ('Authenticity', (result.authenticity * 100) | round(1), '#f59e0b'),
      ] %}
      {% for label, pct, colour in scores %}
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 flex flex-col items-center gap-3">
        <svg width="100" height="100" viewBox="0 0 100 100" class="-rotate-90">
          <circle cx="50" cy="50" r="45" fill="none" stroke="#e5e7eb" stroke-width="10"/>
          <circle cx="50" cy="50" r="45" fill="none" stroke="{{ colour }}" stroke-width="10"
                  stroke-linecap="round"
                  stroke-dasharray="283"
                  stroke-dashoffset="{{ 283 - (283 * pct / 100) }}"
                  class="ring-anim"/>
        </svg>
        <div class="text-center -mt-14">
          <p class="text-2xl font-bold text-gray-800">{{ pct }}%</p>
          <p class="text-xs text-gray-400 mt-0.5">{{ label }}</p>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Recommended Role -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 px-6 py-5 flex items-center gap-4">
      <div class="w-10 h-10 bg-indigo-50 rounded-xl flex items-center justify-center text-xl flex-shrink-0">&#127919;</div>
      <div>
        <p class="text-xs text-gray-400 font-medium">Recommended Role</p>
        <p class="text-lg font-semibold text-gray-800">{{ result.role }}</p>
      </div>
    </div>

    <!-- Skills -->
    <div class="grid sm:grid-cols-2 gap-5">
      <!-- Resume Skills -->
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
        <h3 class="font-semibold text-gray-700 text-sm mb-4">Resume Skills</h3>
        {% if result.resume_skills %}
        <div class="flex flex-wrap gap-2">
          {% for s in result.resume_skills %}
          <span class="bg-indigo-50 text-indigo-600 px-2.5 py-1 rounded-md text-xs font-medium">{{ s }}</span>
          {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-400 text-sm">No skills extracted.</p>
        {% endif %}
      </div>
      <!-- GitHub Skills -->
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
        <h3 class="font-semibold text-gray-700 text-sm mb-4">GitHub Skills</h3>
        {% if result.github_skills %}
        <div class="flex flex-wrap gap-2">
          {% for s in result.github_skills %}
          <span class="bg-emerald-50 text-emerald-600 px-2.5 py-1 rounded-md text-xs font-medium">{{ s }}</span>
          {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-400 text-sm">No GitHub data.</p>
        {% endif %}
      </div>
    </div>

    <!-- Coding Activity -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
      <h3 class="font-semibold text-gray-700 text-sm mb-5">Coding Activity</h3>
      <div class="space-y-4">
        <!-- GitHub repos -->
        <div>
          <div class="flex justify-between text-xs text-gray-500 mb-1.5">
            <span>GitHub Repos</span><span>{{ result.repo_count }}</span>
          </div>
          <div class="bg-gray-200 rounded-full h-2">
            <div class="bg-indigo-500 rounded-full h-2 bar-fill"
                 data-pct="{{ [result.repo_count * 5, 100] | min }}"
                 style="width:{{ [result.repo_count * 5, 100] | min }}%"></div>
          </div>
        </div>
        {% if result.leetcode_stats %}
        {% set lc = result.leetcode_stats %}
        <!-- LeetCode total -->
        <div>
          <div class="flex justify-between text-xs text-gray-500 mb-1.5">
            <span>LeetCode Solved (Total)</span><span>{{ lc.total }}</span>
          </div>
          <div class="bg-gray-200 rounded-full h-2">
            <div class="bg-indigo-500 rounded-full h-2 bar-fill"
                 data-pct="{{ [lc.total / 3, 100] | min | round }}"
                 style="width:{{ [lc.total / 3, 100] | min | round }}%"></div>
          </div>
        </div>
        <!-- Easy / Medium / Hard -->
        {% for label, val, col in [('Easy', lc.easy, 'bg-green-400'), ('Medium', lc.medium, 'bg-yellow-400'), ('Hard', lc.hard, 'bg-red-400')] %}
        <div>
          <div class="flex justify-between text-xs text-gray-500 mb-1.5">
            <span>{{ label }}</span><span>{{ val }}</span>
          </div>
          <div class="bg-gray-200 rounded-full h-1.5">
            <div class="{{ col }} rounded-full h-1.5 bar-fill"
                 data-pct="{{ [val / 2, 100] | min | round }}"
                 style="width:{{ [val / 2, 100] | min | round }}%"></div>
          </div>
        </div>
        {% endfor %}
        {% endif %}
      </div>
    </div>

    <!-- Skill Gaps -->
    {% if result.gaps %}
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
      <h3 class="font-semibold text-gray-700 text-sm mb-4">Skill Gaps</h3>
      <div class="flex flex-wrap gap-2">
        {% for gap in result.gaps %}
        <span class="bg-red-50 text-red-600 px-2.5 py-1 rounded-md text-xs font-medium">{{ gap }}</span>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Roadmap -->
    {% if result.roadmap %}
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
      <h3 class="font-semibold text-gray-700 text-sm mb-4">Learning Roadmap</h3>
      <ol class="space-y-3">
        {% for item in result.roadmap %}
        {% set parts = item.split(' | ') %}
        <li class="flex gap-3">
          <span class="w-6 h-6 bg-indigo-600 text-white rounded-full text-xs flex items-center justify-center flex-shrink-0 font-semibold">{{ loop.index }}</span>
          <div>
            <p class="text-sm font-medium text-gray-700">{{ parts[0] }}</p>
            {% if parts | length > 1 %}
            <p class="text-xs text-gray-400 mt-0.5">{{ parts[1] }}</p>
            {% endif %}
          </div>
        </li>
        {% endfor %}
      </ol>
    </div>
    {% endif %}

    <!-- Browse Jobs CTA -->
    <div class="bg-indigo-600 rounded-2xl p-6 flex items-center justify-between gap-4 flex-wrap">
      <div>
        <p class="text-white font-semibold">Ready to apply?</p>
        <p class="text-indigo-100 text-sm mt-0.5">Browse jobs matched to your profile.</p>
      </div>
      <a href="/jobs" class="bg-white text-indigo-600 font-semibold px-5 py-2.5 rounded-lg text-sm hover:bg-indigo-50 transition-colors">Browse Jobs &rarr;</a>
    </div>

  </main>

  <footer class="bg-white border-t border-gray-100 py-5 mt-8">
    <p class="text-center text-gray-400 text-xs">PlacementIQ &middot; AI Placement Platform</p>
  </footer>

  <script>
  // Animate bar-fill elements respecting initial style (set server-side)
  // SVG ring is purely CSS animated
  </script>
</body>
</html>