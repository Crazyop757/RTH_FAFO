<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PlacementIQ &ndash; Your Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>
  <style>
    *{font-family:'Inter',sans-serif}
    html{scroll-behavior:smooth}
    body{background:#07080f}
    .mesh{background:radial-gradient(ellipse 140% 90% at 15% -30%,rgba(99,102,241,.3) 0%,transparent 55%),radial-gradient(ellipse 80% 60% at 85% 5%,rgba(139,92,246,.2) 0%,transparent 50%),radial-gradient(ellipse 50% 40% at 50% 110%,rgba(16,185,129,.1) 0%,transparent 50%),#07080f}
    .glass{background:rgba(255,255,255,.04);backdrop-filter:blur(24px) saturate(180%);-webkit-backdrop-filter:blur(24px) saturate(180%);border:1px solid rgba(255,255,255,.08)}
    .gcard{background:rgba(255,255,255,.035);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,.07);transition:transform .25s ease,box-shadow .25s ease,border-color .25s ease}
    .gcard:hover{transform:translateY(-5px);box-shadow:0 24px 48px rgba(99,102,241,.18);border-color:rgba(99,102,241,.4)}
    .grad{background:linear-gradient(135deg,#a5b4fc 0%,#c4b5fd 50%,#6ee7b7 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .pill{background:rgba(99,102,241,.14);border:1px solid rgba(99,102,241,.28)}
    .pill-green{background:rgba(16,185,129,.12);border:1px solid rgba(16,185,129,.25)}
    .pill-amber{background:rgba(245,158,11,.12);border:1px solid rgba(245,158,11,.25)}
    .pill-rose{background:rgba(244,63,94,.12);border:1px solid rgba(244,63,94,.25)}
    .btn-g{background:linear-gradient(135deg,#6366f1 0%,#8b5cf6 100%);box-shadow:0 0 35px rgba(99,102,241,.45),inset 0 1px 0 rgba(255,255,255,.18);transition:all .2s ease}
    .btn-g:hover{box-shadow:0 0 55px rgba(99,102,241,.65),inset 0 1px 0 rgba(255,255,255,.25);transform:translateY(-1px)}
    .btn-o{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.14);transition:all .2s ease}
    .btn-o:hover{background:rgba(255,255,255,.1);border-color:rgba(99,102,241,.5);box-shadow:0 0 20px rgba(99,102,241,.15)}
    .inp{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);color:#fff;transition:all .2s ease}
    .inp::placeholder{color:rgba(255,255,255,.3)}
    .inp:focus{outline:none;border-color:rgba(99,102,241,.7);box-shadow:0 0 0 3px rgba(99,102,241,.18);background:rgba(255,255,255,.09)}
    .divline{background:linear-gradient(90deg,transparent,rgba(255,255,255,.09),transparent);height:1px}
    .tag{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.1)}
    .shead{background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.06)}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
    @keyframes pglow{0%,100%{opacity:.4;transform:scale(1)}50%{opacity:1;transform:scale(1.1)}}
    @keyframes dash{from{stroke-dashoffset:339}}
    .ring-a{animation:dash 1.1s ease-out forwards}
    @keyframes grow{from{width:0}}
    .bar-a{animation:grow 1s ease-out forwards}
    @keyframes spin{to{transform:rotate(360deg)}}
    .spin{animation:spin .7s linear infinite}
    .file-drop-active{border-color:#6366f1!important;background:rgba(99,102,241,.08)!important}
    .nav-link{color:rgba(255,255,255,.55);transition:color .2s ease}
    .nav-link:hover{color:#fff}
    .nav-link.active{color:#a5b4fc;font-weight:600}
  </style>
</head>
<body class="mesh text-white antialiased min-h-screen flex flex-col">
  <nav class="glass sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-6 h-16 flex items-center justify-between">
      <a href="/home" class="flex items-center gap-3"><div class="w-8 h-8 rounded-xl flex items-center justify-center font-black text-sm text-white" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);box-shadow:0 0 18px rgba(99,102,241,.55)">P</div><span class="font-bold text-white tracking-tight">PlacementIQ</span></a>
      <div class="flex items-center gap-6">
        <a href="/jobs" class="nav-link text-sm">Browse Jobs</a>
        <a href="/" class="nav-link text-sm">Analysis</a>
        {% if session.user %}<span class="tag text-white/50 text-xs px-3 py-1.5 rounded-xl">{{ session.user }}</span>{% endif %}
        <a href="/logout" class="btn-o text-white/70 px-4 py-1.5 rounded-xl text-xs font-medium">Logout</a>
      </div>
    </div>
  </nav>
  <main class="max-w-5xl mx-auto px-6 py-10 space-y-6 flex-1">

    <div class="flex items-start justify-between flex-wrap gap-4">
      <div>
        <h1 class="text-2xl font-black text-white tracking-tight">Placement Report</h1>
        <p class="text-white/40 text-sm mt-1">AI analysis for <span class="text-white/70 font-semibold">{{ result.meta.resume_filename }}</span></p>
      </div>
      <a href="/" class="btn-o text-white/70 px-4 py-2.5 rounded-xl text-sm font-medium">&larr; New Analysis</a>
    </div>

    <div class="gcard rounded-2xl px-6 py-4 flex flex-wrap gap-x-8 gap-y-2 text-sm">
      {% if result.meta.github_user %}<span class="flex items-center gap-2 text-white/50">GitHub <span class="text-white font-semibold">{{ result.meta.github_user }}</span></span>{% endif %}
      {% if result.meta.leetcode_user %}<span class="flex items-center gap-2 text-white/50">LeetCode <span class="text-white font-semibold">{{ result.meta.leetcode_user }}</span></span>{% endif %}
      {% if result.meta.cgpa %}<span class="flex items-center gap-2 text-white/50">CGPA <span class="text-white font-semibold">{{ result.meta.cgpa }}</span></span>{% endif %}
    </div>

    {% if result.warnings %}
    <div class="rounded-2xl px-6 py-4 space-y-1.5" style="background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.25)">
      <h3 class="text-sm font-bold text-amber-300">&#9888; Flags</h3>
      {% for w in result.warnings %}<p class="text-amber-300/80 text-sm">&bull; {{ w }}</p>{% endfor %}
    </div>
    {% endif %}

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-5">
      {% set scores = [
        ('Readiness',    result.readiness | round(1),           '#818cf8', 'rgba(99,102,241,.15)'),
        ('Role Match',   (result.match * 100) | round(1),       '#34d399', 'rgba(16,185,129,.12)'),
        ('Authenticity', (result.authenticity * 100) | round(1),'#fbbf24', 'rgba(245,158,11,.12)'),
      ] %}
      {% for label, pct, colour, bg in scores %}
      <div class="gcard rounded-2xl p-7 flex flex-col items-center" style="background:{{ bg }};border-color:{{ colour }}33">
        <div class="relative w-32 h-32 mb-4">
          <svg width="128" height="128" viewBox="0 0 128 128" class="absolute inset-0 -rotate-90">
            <circle cx="64" cy="64" r="54" fill="none" stroke="rgba(255,255,255,.08)" stroke-width="10"/>
            <circle cx="64" cy="64" r="54" fill="none" stroke="{{ colour }}" stroke-width="10"
                    stroke-linecap="round" stroke-dasharray="339"
                    stroke-dashoffset="{{ 339 - (339 * pct / 100) }}"
                    class="ring-a" style="filter:drop-shadow(0 0 8px {{ colour }}88)"/>
          </svg>
          <div class="absolute inset-0 flex flex-col items-center justify-center">
            <p class="text-3xl font-black text-white">{{ pct }}%</p>
          </div>
        </div>
        <p class="text-sm font-bold text-white/70">{{ label }}</p>
      </div>
      {% endfor %}
    </div>

    <div class="rounded-2xl px-6 py-5 flex items-center gap-5" style="background:linear-gradient(135deg,rgba(99,102,241,.18),rgba(139,92,246,.18));border:1px solid rgba(99,102,241,.35)">
      <div class="w-12 h-12 rounded-2xl flex items-center justify-center text-xl flex-shrink-0" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);box-shadow:0 0 25px rgba(99,102,241,.45)">&#127919;</div>
      <div>
        <p class="text-xs font-bold uppercase tracking-widest text-indigo-400 mb-0.5">Recommended Role</p>
        <p class="text-xl font-black text-white">{{ result.role }}</p>
      </div>
    </div>

    <div class="grid sm:grid-cols-2 gap-5">
      <div class="gcard rounded-2xl p-6">
        <h3 class="font-bold text-white text-sm mb-4 flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-indigo-400"></span>Resume Skills</h3>
        {% if result.resume_skills %}<div class="flex flex-wrap gap-2">{% for s in result.resume_skills %}<span class="pill text-indigo-300 px-3 py-1.5 rounded-lg text-xs font-medium">{{ s }}</span>{% endfor %}</div>
        {% else %}<p class="text-white/35 text-sm">No skills extracted.</p>{% endif %}
      </div>
      <div class="gcard rounded-2xl p-6">
        <h3 class="font-bold text-white text-sm mb-4 flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-emerald-400"></span>GitHub Skills</h3>
        {% if result.github_skills %}<div class="flex flex-wrap gap-2">{% for s in result.github_skills %}<span class="pill-green text-emerald-300 px-3 py-1.5 rounded-lg text-xs font-medium">{{ s }}</span>{% endfor %}</div>
        {% else %}<p class="text-white/35 text-sm">No GitHub data.</p>{% endif %}
      </div>
    </div>

    <div class="gcard rounded-2xl p-6">
      <h3 class="font-bold text-white text-sm mb-6 flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-violet-400"></span>Coding Activity</h3>
      <div class="space-y-5">
        <div>
          <div class="flex justify-between text-xs mb-2"><span class="text-white/50 font-medium">GitHub Repos</span><span class="text-white font-bold">{{ result.repo_count }}</span></div>
          <div class="rounded-full h-2" style="background:rgba(255,255,255,.08)"><div class="bg-indigo-400 rounded-full h-2 bar-a" style="width:min({{ result.repo_count * 5 }},100)%"></div></div>
        </div>
        {% if result.leetcode_stats %}{% set lc = result.leetcode_stats %}
        <div>
          <div class="flex justify-between text-xs mb-2"><span class="text-white/50 font-medium">LeetCode Solved</span><span class="text-white font-bold">{{ lc.total }}</span></div>
          <div class="rounded-full h-2" style="background:rgba(255,255,255,.08)"><div class="bg-indigo-400 rounded-full h-2 bar-a" style="width:{{ [lc.total // 3, 100] | min }}%"></div></div>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <div class="shead rounded-xl p-3 text-center"><p class="text-lg font-black text-emerald-400">{{ lc.easy }}</p><p class="text-xs text-white/35 mt-0.5">Easy</p></div>
          <div class="shead rounded-xl p-3 text-center"><p class="text-lg font-black text-amber-400">{{ lc.medium }}</p><p class="text-xs text-white/35 mt-0.5">Medium</p></div>
          <div class="shead rounded-xl p-3 text-center"><p class="text-lg font-black text-rose-400">{{ lc.hard }}</p><p class="text-xs text-white/35 mt-0.5">Hard</p></div>
        </div>
        {% endif %}
      </div>
    </div>

    {% if result.gaps %}
    <div class="gcard rounded-2xl p-6">
      <h3 class="font-bold text-white text-sm mb-4 flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-rose-400"></span>Skill Gaps</h3>
      <div class="flex flex-wrap gap-2">{% for g in result.gaps %}<span class="pill-rose text-rose-300 px-3 py-1.5 rounded-lg text-xs font-medium">{{ g }}</span>{% endfor %}</div>
    </div>
    {% endif %}

    {% if result.roadmap %}
    <div class="gcard rounded-2xl p-6">
      <h3 class="font-bold text-white text-sm mb-6 flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-amber-400"></span>Learning Roadmap</h3>
      <ol class="space-y-4">
        {% for item in result.roadmap %}{% set parts = item.split(' | ') %}
        <li class="flex gap-4">
          <span class="w-7 h-7 rounded-xl text-white text-xs flex items-center justify-center flex-shrink-0 font-black" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);box-shadow:0 0 12px rgba(99,102,241,.4)">{{ loop.index }}</span>
          <div class="pt-0.5"><p class="text-sm font-semibold text-white">{{ parts[0] }}</p>{% if parts|length > 1 %}<p class="text-xs text-white/40 mt-0.5">{{ parts[1] }}</p>{% endif %}</div>
        </li>
        {% endfor %}
      </ol>
    </div>
    {% endif %}

    <div class="rounded-2xl p-7 flex items-center justify-between gap-4 flex-wrap" style="background:linear-gradient(135deg,rgba(99,102,241,.25),rgba(139,92,246,.25));border:1px solid rgba(99,102,241,.4);box-shadow:0 0 40px rgba(99,102,241,.15)">
      <div><p class="text-white font-black text-lg">Ready to apply?</p><p class="text-white/50 text-sm mt-0.5">Browse jobs matched to your profile.</p></div>
      <a href="/jobs" class="btn-g text-white font-bold px-6 py-3 rounded-xl text-sm flex-shrink-0">Browse Jobs &rarr;</a>
    </div>
  </main>
  <footer class="border-t mt-auto py-8 px-6" style="border-color:rgba(255,255,255,.06)">
    <p class="text-center text-white/25 text-xs">PlacementIQ &middot; AI Placement Platform</p>
  </footer>

  <!-- Chatbot Widget -->
  <div id="chatBtn" class="fixed bottom-6 right-6 w-14 h-14 rounded-full btn-g flex items-center justify-center text-2xl cursor-pointer z-[9998] transition-transform hover:scale-110" style="animation:pglow 3s ease-in-out infinite" title="Ask me anything">ðŸ’¬</div>
  
  <div id="chatWindow" class="fixed bottom-24 right-6 w-96 max-w-[90vw] h-[500px] gcard rounded-3xl shadow-2xl z-[9999] flex-col hidden" style="box-shadow:0 25px 60px rgba(0,0,0,.5)">
    <div class="flex items-center justify-between px-5 py-4 border-b" style="background:linear-gradient(135deg,rgba(99,102,241,.2),rgba(139,92,246,.2));border-color:rgba(255,255,255,.1);border-radius:1.5rem 1.5rem 0 0">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-xl flex items-center justify-center text-sm" style="background:linear-gradient(135deg,#6366f1,#8b5cf6)">ðŸ’¬</div>
        <div><p class="text-white font-bold text-sm">PlacementIQ Assistant</p><p class="text-white/40 text-xs">Ask me anything</p></div>
      </div>
      <button id="closeChat" class="text-white/60 hover:text-white text-xl leading-none transition-colors">&times;</button>
    </div>
    
    <div id="chatMessages" class="flex-1 overflow-y-auto px-5 py-4 space-y-3" style="scrollbar-width:thin;scrollbar-color:rgba(99,102,241,.3) transparent"></div>
    
    <div id="typingIndicator" class="hidden px-5 pb-2"><div class="inline-block pill px-4 py-2 rounded-2xl"><div class="flex gap-1"><span class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce"></span><span class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay:.15s"></span><span class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay:.3s"></span></div></div></div>
    
    <div class="px-5 py-4 border-t" style="border-color:rgba(255,255,255,.08)">
      <div class="flex gap-2">
        <input id="chatInput" type="text" placeholder="Type your question..." class="inp flex-1 px-4 py-3 rounded-2xl text-sm" style="background:rgba(255,255,255,.08)"/>
        <button id="sendBtn" class="btn-g px-5 rounded-2xl font-semibold text-sm">Send</button>
      </div>
    </div>
  </div>

  <script>
  const chatBtn=document.getElementById('chatBtn');
  const chatWindow=document.getElementById('chatWindow');
  const closeChat=document.getElementById('closeChat');
  const chatMessages=document.getElementById('chatMessages');
  const chatInput=document.getElementById('chatInput');
  const sendBtn=document.getElementById('sendBtn');
  const typingIndicator=document.getElementById('typingIndicator');
  
  function toggleChat(){
    chatWindow.classList.toggle('hidden');
    chatWindow.classList.toggle('flex');
    if(!chatWindow.classList.contains('hidden')){
      chatInput.focus();
      if(chatMessages.children.length===0){
        addBotMessage("Hi! I'm your PlacementIQ assistant. Ask me anything about the platform, authenticity scores, GitHub integration, or job matching!");
      }
    }
  }
  
  chatBtn.addEventListener('click',toggleChat);
  closeChat.addEventListener('click',toggleChat);
  
  function addUserMessage(msg){
    const div=document.createElement('div');
    div.className='flex justify-end';
    div.innerHTML=`<div class="btn-g px-4 py-2.5 rounded-2xl max-w-[75%] text-sm text-white">${escapeHtml(msg)}</div>`;
    chatMessages.appendChild(div);
    chatMessages.scrollTop=chatMessages.scrollHeight;
  }
  
  function addBotMessage(msg){
    const wrap=document.createElement('div');
    wrap.className='flex justify-start';
    const bubble=document.createElement('div');
    bubble.className='pill px-4 py-2.5 rounded-2xl max-w-[75%] text-sm text-white/90';
    bubble.style.cssText='white-space:pre-wrap;word-break:break-word;min-height:1.4em';
    wrap.appendChild(bubble);
    chatMessages.appendChild(wrap);
    chatMessages.scrollTop=chatMessages.scrollHeight;
    const chars=[...msg];
    let i=0;
    const pause={'\n':60,'.':55,'!':55,'?':55,',':30};
    (function type(){
      if(i>=chars.length)return;
      bubble.textContent+=chars[i];
      chatMessages.scrollTop=chatMessages.scrollHeight;
      setTimeout(type,pause[chars[i++]]??9);
    })();
  }
  
  function showTyping(){typingIndicator.classList.remove('hidden');}
  function hideTyping(){typingIndicator.classList.add('hidden');}
  
  async function sendMessage(){
    const msg=chatInput.value.trim();
    if(!msg)return;
    addUserMessage(msg);
    chatInput.value='';
    showTyping();
    try{
      const res=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg})});
      
      if(!res.ok){
        hideTyping();
        addBotMessage("Server error. Please make sure Flask is running!");
        console.error('HTTP Error:',res.status,res.statusText);
        return;
      }
      
      const data=await res.json();
      hideTyping();
      
      if(data.response){
        addBotMessage(data.response);
      }else if(data.error){
        addBotMessage("Error: "+data.error);
      }else{
        addBotMessage("Sorry, I couldn't process that. Please try again!");
      }
    }catch(err){
      hideTyping();
      addBotMessage("Connection error! Make sure the server is running.");
      console.error('Fetch error:',err);
    }
  }
  
  sendBtn.addEventListener('click',sendMessage);
  chatInput.addEventListener('keypress',e=>{if(e.key==='Enter')sendMessage();});
  
  function escapeHtml(text){
    const div=document.createElement('div');
    div.textContent=text;
    return div.innerHTML;
  }
  </script>
</body>
</html>